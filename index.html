<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>CLICK RNG</title>

    <!-- Titan One font -->
    <link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">

    <style>
        :root {
            --green: #34c759;
            --dark-bg: #000;
            --light-bg: #fff;
            --text-light: #fff;
            --text-dark: #000;
            --rare-grad: linear-gradient(135deg, #6dd5fa, #2980b9);
            --legend-grad: linear-gradient(135deg, #fbd786, #f7797d);
            --godly-grad: linear-gradient(135deg, #ff9aeb, #fad0c4);
            --rgb-grad: conic-gradient(red, orange, yellow, green, cyan, blue, purple, red);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Titan One', cursive;
        }

        body {
            background: var(--light-bg);
            color: var(--text-dark);
            height: 100vh;
            overflow: hidden;
        }

        .hidden {
            display: none
        }

        button {
            cursor: pointer;
            border: none;
            font-size: 1rem;
            padding: .5rem 1rem;
            border-radius: .5rem;
            font-weight: bold
        }

        #loading-screen,
        #start-screen,
        #game-screen,
        #rarity-screen {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem
        }

        #loading-bar-wrapper {
            width: 60%;
            height: 12px;
            background: #ccc;
            border-radius: 6px;
            overflow: hidden
        }

        #loading-bar {
            height: 100%;
            width: 0;
            background: var(--green)
        }

        #title {
            font-size: 4rem;
            letter-spacing: 2px;
            color: var(--green)
        }

        #btn-go {
            background: var(--green);
            color: #fff;
            font-size: 2rem;
            padding: .75rem 2rem;
            margin-bottom: 4rem;
            cursor: pointer;
            z-index: 99;
            position: relative;
        }

        #toggle-dark {
            margin-left: .5rem;
            transform: scale(1.3)
        }

        /* Flicker when body.dark */
        @keyframes flicker {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: .5
            }
        }

        body.dark #title {
            animation: flicker .2s infinite alternate
        }

        /* Stats panel */
        #btn-stats {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--green);
            color: #fff
        }

        #stats-panel {
            position: absolute;
            top: 4rem;
            left: 1rem;
            background: #ffffffee;
            padding: 1rem;
            border-radius: .5rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .2)
        }

        #stats-panel.dark {
            background: #000000ee;
            color: #fff
        }

        #stats-panel ul {
            list-style: none;
            margin-bottom: .5rem
        }

        #stats-panel li {
            margin: .25rem 0
        }

        #btn-reset {
            background: #ef5350;
            color: #fff;
            font-size: .8rem
        }

        /* Dev overlay */
        #dev-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none
        }

        /* Rarity screen */
        #rarity-screen {
            text-align: center
        }

        #rarity-name {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-transform: uppercase
        }

        .shine {
            background: linear-gradient(90deg, #fff 0%, #fff 40%, rgba(255, 255, 255, 0) 60%);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 2s linear infinite;
        }

        @keyframes shine {
            0% {
                background-position: -100% 0
            }

            100% {
                background-position: 100% 0
            }
        }

        #percent {
            font-size: 1.5rem;
            margin-bottom: 2rem
        }

        #btn-back {
            background: var(--green);
            color: #fff
        }

        /* Dark-mode helpers */
        body.dark {
            background: var(--dark-bg);
            color: var(--text-light)
        }

        body.dark button {
            color: #fff
        }
    </style>
</head>

<body>

    <!-- Loading screen -->
    <div id="loading-screen">
        <div>Loadingâ€¦</div>
        <div id="loading-bar-wrapper">
            <div id="loading-bar"></div>
        </div>
    </div>

    <!-- Start screen -->
    <div id="start-screen" class="hidden">
        <h1 id="title">CLICK RNG</h1>
        <button id="btn-go">GO</button>
        <label><input type="checkbox" id="toggle-dark"> Dark mode</label>
    </div>

    <!-- Game screen -->
    <div id="game-screen" class="hidden">
        <button id="btn-stats">Stats</button>
        <div id="stats-panel" class="hidden">
            <ul id="stats-list"></ul>
            <button id="btn-reset">Reset stats</button>
        </div>
        <div id="dev-overlay" class="hidden"></usep>
        <p style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem;">Click anywhere to reveal a rarity</p>
    </div>

    <!-- Rarity result screen -->
    <div id="rarity-screen" class="hidden">
        <h2 id="rarity-name"></h2>
        <div id="percent"></div>
        <button id="btn-back">Back</button>
    </div>

    <script>
        /* ==== CONFIG ==== */
        const rarities = [
            { name: 'common', prob: 55, color: '#ffffff', bg: null, sound: 'BASE64_COMMON', online: 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_19ad9abf2e.mp3?filename=click-124467.mp3' },
            { name: 'uncommon', prob: 35, color: '#d1d1d1', bg: null, sound: 'BASE64_UNCOMMON', online: 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_19ad9abf2e.mp3?filename=click-124467.mp3' },
            { name: 'rare', prob: 15, color: '#6dd5fa', bg: 'var(--rare-grad)', sound: 'BASE64_RARE', online: 'https://cdn.pixabay.com/download/audio/2022/03/23/audio_19a60fba98.mp3?filename=magic-notification-133128.mp3' },
            { name: 'legendary', prob: 6, color: '#fbd786', bg: 'var(--legend-grad)', sound: 'BASE64_LEGEND', online: 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_615cd4c4cf.mp3?filename=tada-fanfare-a-6313.mp3' },
            { name: 'godly', prob: 2, color: '#ff9aeb', bg: 'var(--godly-grad)', sound: 'BASE64_GODLY', online: 'https://cdn.pixabay.com/download/audio/2023/07/19/audio_418b59864a.mp3?filename=level-up-141186.mp3' },
            { name: '???', prob: 0.1, color: '#000', bg: 'var(--rgb-grad)', sound: 'BASE64_UNKNOWN', online: 'https://cdn.pixabay.com/download/audio/2022/03/15/audio_7ca652f8da.mp3?filename=coin-collect-retro-8-bit-sound-effect-145251.mp3' }
        ];
        const gridCols = 20, gridRows = 12; // controls zone density
        /* ==== STATE ==== */
        let zones = [], stats = {}, dark = false, devMode = false;
        /* ==== ELEMENTS ==== */
        const el = { loading: 'loading-screen', start: 'start-screen', game: 'game-screen', rarity: 'rarity-screen' }
        Object.keys(el).forEach(k => el[k] = document.getElementById(el[k]));
        const loadingBar = document.getElementById('loading-bar');
        const btnGo = document.getElementById('btn-go');
        const chkDark = document.getElementById('toggle-dark');
        const btnStats = document.getElementById('btn-stats');
        const statsPanel = document.getElementById('stats-panel');
        const statsList = document.getElementById('stats-list');
        const btnReset = document.getElementById('btn-reset');
        const rarityName = document.getElementById('rarity-name');
        const percentEl = document.getElementById('percent');
        const btnBack = document.getElementById('btn-back');
        const devOverlay = document.getElementById('dev-overlay');
        /* ==== UTILITIES ==== */
        function loadAudio(r) { 
            const a = new Audio(); 
            a.src = r.sound.startsWith('BASE64_') ? r.online : r.sound; 
            return a 
        }
        rarities.forEach(r => r.audio = loadAudio(r));
        function saveStats() { localStorage.setItem('rngStats', JSON.stringify(stats)) }
        function loadStats() { 
            stats = JSON.parse(localStorage.getItem('rngStats') || '{}'); 
            rarities.forEach(r => { if (!stats[r.name]) stats[r.name] = 0 }) 
        }
        function updateStatsUI() {
            statsList.innerHTML = rarities.map(r => `<li>${r.name}: ${stats[r.name]}</li>`).join('');
            statsPanel.classList.toggle('dark', dark);
        }
        function toggleDark(b) {
            dark = b;
            document.body.classList.toggle('dark', dark);
        }
        function randChoice() {
            const t = rarities.reduce((s, r) => s + r.prob, 0); 
            let x = Math.random() * t;
            for (const r of rarities) { 
                if (x < r.prob) return r; 
                x -= r.prob 
            }
            return rarities[0];
        }
        function buildZones() {
            zones = [];
            const cw = window.innerWidth / gridCols, ch = window.innerHeight / gridRows;
            for (let y = 0; y < gridRows; y++) {
                for (let x = 0; x < gridCols; x++) {
                    const rarity = randChoice();
                    zones.push({ x: x * cw, y: y * ch, w: cw, h: ch, rarity });
                }
            }
        }
        function showScreen(s) {
            [el.start, el.loading, el.game, el.rarity].forEach(e => e.classList.add('hidden'));
            s.classList.remove('hidden');
        }
        function playSound(r) { 
            r.audio.currentTime = 0; 
            r.audio.play().catch(() => { /* Ignore errors to prevent game stoppage */ }); 
        }
        /* ==== FLOW ==== */
        function init() {
            // Fake loading bar
            let p = 0; 
            const iv = setInterval(() => { 
                p += 5; 
                loadingBar.style.width = p + '%'; 
                if (p >= 100) { 
                    clearInterval(iv); 
                    showScreen(el.start) 
                } 
            }, 50);
            loadStats(); 
            updateStatsUI();
        }
        function startGame() {
            showScreen(el.loading);
            setTimeout(() => { // 2.5 s scrambling delay
                buildZones();
                drawDevOverlay();
                showScreen(el.game);
            }, 2500);
        }
        function clickGame(e) {
            const z = zones.find(z => e.clientX >= z.x && e.clientX < z.x + z.w && e.clientY >= z.y && e.clientY < z.y + z.h);
            if (!z) return;
            const r = z.rarity;
            stats[r.name]++; 
            saveStats(); 
            updateStatsUI();
            rarityName.textContent = r.name;
            percentEl.textContent = `(${r.prob}%)`;
            rarityName.classList.toggle('shine', r.name !== 'common' && r.name !== 'uncommon');
            // Background
            el.rarity.style.background = r.bg || (dark ? 'var(--dark-bg)' : 'var(--light-bg)');
            playSound(r);
            showScreen(el.rarity);
        }
        function drawDevOverlay() {
            if (!devMode) { 
                devOverlay.innerHTML = ''; 
                return 
            }
            const fr = document.createDocumentFragment();
            zones.forEach(z => {
                const d = document.createElement('div');
                Object.assign(d.style, {
                    position: 'absolute',
                    left: z.x + 'px', 
                    top: z.y + 'px', 
                    width: z.w + 'px', 
                    height: z.h + 'px',
                    background: z.rarity.bg || z.rarity.color,
                    opacity: .4, 
                    border: '1px solid #000'
                });
                fr.appendChild(d);
            });
            devOverlay.innerHTML = ''; 
            devOverlay.appendChild(fr);
        }
        function detectDevSequence() {
            const seq = ['d', 'e', 'v', 'm', 'o', 'd', 'e']; 
            let idx = 0;
            window.addEventListener('keydown', e => {
                if (e.key.toLowerCase() === seq[idx]) { 
                    idx++; 
                    if (idx === seq.length) { 
                        devMode = !devMode; 
                        devOverlay.classList.toggle('hidden', !devMode); 
                        drawDevOverlay(); 
                        idx = 0 
                    } 
                } else idx = 0;
            });
        }
        /* ==== EVENT WIRES ==== */
        btnGo.addEventListener('click', startGame);
        chkDark.addEventListener('change', e => toggleDark(e.target.checked));
        btnStats.addEventListener('click', () => statsPanel.classList.toggle('hidden'));
        btnReset.addEventListener('click', () => { 
            rarities.forEach(r => stats[r.name] = 0); 
            saveStats(); 
            updateStatsUI() 
        });
        el.game.addEventListener('click', clickGame);
        btnBack.addEventListener('click', () => showScreen(el.game));
        window.addEventListener('resize', () => { 
            buildZones(); 
            drawDevOverlay() 
        });
        detectDevSequence();
        /* ==== START ==== */
        init();
    </script>
</body>

</html>